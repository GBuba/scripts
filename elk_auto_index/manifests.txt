secret.yaml

apiVersion: v1
kind: Secret
metadata:
  name: elk-secret
  namespace: your-namespace  # –£–∫–∞–∂–∏—Ç–µ –∑–¥–µ—Å—å –Ω—É–∂–Ω–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –∏–º–µ–Ω
type: Opaque
data:
  password: cGFzc3dvcmQ=  # –ó–¥–µ—Å—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è base64-–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤–∞—à–µ–≥–æ –ø–∞—Ä–æ–ª—è


configmap.yaml

apiVersion: v1
kind: ConfigMap
metadata:
  name: elk-config
  namespace: your-namespace  # –£–∫–∞–∂–∏—Ç–µ –∑–¥–µ—Å—å —Ç–æ –∂–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –∏–º–µ–Ω
data:
  common_name: test, audit


CronJob.yaml

apiVersion: batch/v1
kind: CronJob
metadata:
  name: elk-auto-index-py
  namespace: kibana
apiVersion: batch/v1
kind: CronJob
metadata:
  name: elk-auto-index-py
  namespace: kibana
spec:
  schedule: "0 0 * * *"  # –ó–∞–ø—É—Å–∫ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ –ø–æ–ª–Ω–æ—á—å
  jobTemplate:
    spec:
      template:
        metadata:
          labels:
            app: elk-auto-index-py
          annotations:
            prometheus.io/scrape: "false"  # üõë –û—Ç–∫–ª—é—á–∞–µ–º —Å–±–æ—Ä –º–µ—Ç—Ä–∏–∫ –¥–ª—è Prometheus
        spec:
          affinity:
            podAntiAffinity:
              preferredDuringSchedulingIgnoredDuringExecution:
              - weight: 1
                podAffinityTerm:
                  labelSelector:
                    matchLabels:
                      app: elk-auto-index-py
                  topologyKey: kubernetes.io/hostname
          containers:
          - name: elk-auto-index-py
            image: artifactory.com/elk-auto-index-py:prod1.0
            imagePullPolicy: IfNotPresent
            env:
            - name: ELK_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: elk-secret
                  key: password
            volumeMounts:
            - name: config-volume
              mountPath: "/etc/config"
              readOnly: true
          nodeSelector:
            kubernetes.io/hostname: moscow-3.net
          tolerations:
          - effect: NoSchedule
            key: app
            operator: Equal
            value: infra
          restartPolicy: Never
          volumes:
          - name: config-volume
            configMap:
              name: elk-config
  successfulJobsHistoryLimit: 1  # –ù–µ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å, –µ—Å–ª–∏ pod —É—Å–ø–µ—à–Ω—ã–π
  failedJobsHistoryLimit: 1      # –°–æ—Ö—Ä–∞–Ω—è—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π –Ω–µ—É—Å–ø–µ—à–Ω—ã–π pod
  
